<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Musica Classica</title>
    <style>
        body { margin: 0; font-family: -apple-system, system-ui, sans-serif; background: #f0f0f0; color: #1a1a1a; }
        
        /* Barre Superiori */
        .header-fisso { 
            position: fixed; top: 0; width: 100%; height: 60px; 
            background: #ffffff; color: #000; display: flex; 
            align-items: center; justify-content: space-between; z-index: 1000;
            padding: 0 10px; box-sizing: border-box; border-bottom: 1px solid #ddd;
        }

        /* Liste */
        #schermata-lista, #schermata-composizioni { padding: 15px; margin-top: 5px; }
        .riga-container { 
            display: flex; gap: 10px; margin-bottom: 12px; align-items: stretch;
        }

        /* Pulsanti Generali */
        button { 
            background: white; color: black; border: 1px solid #ccc; 
            padding: 12px; border-radius: 8px; font-size: 15px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        button:active { background: #e0e0e0; }

        /* Pulsanti specifici */
        .btn-nome-principale { flex: 3; text-align: left; justify-content: flex-start; font-weight: 500; }
        .btn-opere-piccolo { flex: 1; font-size: 13px; text-transform: uppercase; font-weight: bold; }
        .btn-header { padding: 6px 10px; font-size: 13px; font-weight: bold; }
        .btn-indietro { background: #f8d7da; border-color: #f5c6cb; }

        /* Iframe */
        .wrap-iframe { margin-top: 60px; width: 100%; height: calc(100vh - 60px); overflow-y: auto; -webkit-overflow-scrolling: touch; }
        iframe { width: 100%; height: 6000px; border: none; pointer-events: none; background: white; }

        .nascosto { display: none !important; }
        #titolo-corrente { font-size: 13px; font-weight: bold; text-align: center; flex: 1; padding: 0 5px; color: #555; }
    </style>
</head>
<body>

    <div id="schermata-lista">
        <h2 style="margin-left: 5px;">Compositori</h2>
        <div id="lista-corpo"></div>
    </div>

    <div id="schermata-composizioni" class="nascosto">
        <div class="header-fisso">
            <button class="btn-header btn-indietro" onclick="mostraLista()">Lista</button>
            <button class="btn-header" id="btn-comp-vita" style="flex:1; margin: 0 10px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"></button>
            <div style="width:50px"></div> </div>
        <div id="lista-brani-corpo" style="margin-top:70px"></div>
    </div>

    <div id="schermata-dettaglio" class="nascosto">
        <div class="header-fisso" id="testata">
            <button class="btn-header btn-indietro" id="btn-back"></button>
            <span id="titolo-corrente"></span>
            <button class="btn-header" id="btn-azione-destra"></button>
        </div>
        <div class="wrap-iframe">
            <iframe id="frame-wiki" src=""></iframe>
        </div>
    </div>

    <script>
        let datiMusica = [];

        fetch('dati.json')
            .then(res => res.json())
            .then(data => {
                datiMusica = data;
                mostraLista();
            });

        function mostraLista() {
            gestisciVisibilita('schermata-lista');
            const contenitore = document.getElementById('lista-corpo');
            contenitore.innerHTML = '';

            datiMusica.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'riga-container';
                div.innerHTML = `
                    <button class="btn-nome-principale" onclick="apriVita(${index})">${item.compositore}</button>
                    <button class="btn-opere-piccolo" onclick="mostraBrani(${index})">Opere</button>
                `;
                contenitore.appendChild(div);
            });
        }

        function mostraBrani(indexComp) {
            gestisciVisibilita('schermata-composizioni');
            const comp = datiMusica[indexComp];
            
            const btnVita = document.getElementById('btn-comp-vita');
            btnVita.innerText = comp.compositore;
            btnVita.onclick = () => apriVita(indexComp);

            const contenitore = document.getElementById('lista-brani-corpo');
            contenitore.innerHTML = '';

            comp.composizioni.forEach((brano, indexBrano) => {
                const div = document.createElement('div');
                div.className = 'riga-container';
                div.innerHTML = `<button class="btn-nome-principale" style="flex:1" onclick="apriBrano(${indexComp}, ${indexBrano})">${brano.titolo}</button>`;
                contenitore.appendChild(div);
            });
        }

        function apriVita(index) {
            const comp = datiMusica[index];
            configuraIframe(
                comp.compositore, 
                comp.link_wiki, 
                "OPERE", 
                () => mostraBrani(index), 
                "LISTA", 
                mostraLista
            );
        }

        function apriBrano(indexComp, indexBrano) {
            const brano = datiMusica[indexComp].composizioni[indexBrano];
            configuraIframe(
                brano.titolo, 
                brano.link_wiki_comp, 
                "YOUTUBE", 
                () => window.open(brano.link_youtube, '_blank'), 
                "INDIETRO", 
                () => mostraBrani(indexComp)
            );
        }

        function configuraIframe(titolo, url, txtR, azioneR, txtL, azioneL) {
            gestisciVisibilita('schermata-dettaglio');
            document.getElementById('titolo-corrente').innerText = titolo;
            document.getElementById('frame-wiki').src = url;
            
            const btnL = document.getElementById('btn-back');
            btnL.innerText = txtL;
            btnL.onclick = azioneL;

            const btnR = document.getElementById('btn-azione-destra');
            btnR.innerText = txtR;
            btnR.onclick = azioneR;
            window.scrollTo(0,0);
        }

        function gestisciVisibilita(idMostrare) {
            ['schermata-lista', 'schermata-composizioni', 'schermata-dettaglio'].forEach(id => {
                document.getElementById(id).classList.add('nascosto');
            });
            document.getElementById(idMostrare).classList.remove('nascosto');
        }
    </script>
</body>
</html>